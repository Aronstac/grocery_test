# GroceryOps Backend API

–ü–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–∏–π –±–µ–∫–µ–Ω–¥ –¥–ª—è —Å–∏—Å—Ç–µ–º–∏ –ª–æ–≥—ñ—Å—Ç–∏–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω—É, –ø–æ–±—É–¥–æ–≤–∞–Ω–∏–π –Ω–∞ Node.js + Express –∑ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—î—é Supabase.

## üöÄ –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ

- **REST API** –∑ –ø–æ–≤–Ω–∏–º CRUD —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª–æ–º
- **–ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Ç–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è** –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ä–æ–ª–µ–π
- **–í–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö** –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º Zod
- **–õ–æ–≥—É–≤–∞–Ω–Ω—è** –∑ Winston
- **Rate limiting** –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ –∑–ª–æ–≤–∂–∏–≤–∞–Ω—å
- **Email —Å–µ—Ä–≤—ñ—Å** –¥–ª—è –∑–∞–ø—Ä–æ—à–µ–Ω—å
- **–ë–µ–∑–ø–µ–∫–∞** –∑ Helmet —Ç–∞ CORS
- **–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å** –∑ –º–æ–¥—É–ª—å–Ω–æ—é –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–æ—é
- **Seed —Å–∫—Ä–∏–ø—Ç** –¥–ª—è –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è —Ç–µ—Å—Ç–æ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É

```
backend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ config/          # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è (Supabase, –±–∞–∑–∞ –¥–∞–Ω–∏—Ö)
‚îÇ   ‚îú‚îÄ‚îÄ middleware/      # Middleware (auth, validation, errors)
‚îÇ   ‚îú‚îÄ‚îÄ routes/          # API –º–∞—Ä—à—Ä—É—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ services/        # –ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞ —Ç–∞ —Å–µ—Ä–≤—ñ—Å–∏
‚îÇ   ‚îú‚îÄ‚îÄ utils/           # –£—Ç–∏–ª—ñ—Ç–∏ (logger, helpers)
‚îÇ   ‚îî‚îÄ‚îÄ server.js        # –ì–æ–ª–æ–≤–Ω–∏–π —Ñ–∞–π–ª —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ logs/                # –õ–æ–≥ —Ñ–∞–π–ª–∏
‚îú‚îÄ‚îÄ seed.ts              # –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –ë–î
‚îú‚îÄ‚îÄ .env.example         # –ü—Ä–∏–∫–ª–∞–¥ –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
‚îî‚îÄ‚îÄ package.json
```

## üõ† –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

1. **–ö–ª–æ–Ω—É–≤–∞–Ω–Ω—è —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π:**
```bash
cd backend
npm install
```

2. **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞:**
```bash
cp .env.example .env
# –í—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ .env —Ñ–∞–π–ª –∑ –≤–∞—à–∏–º–∏ –¥–∞–Ω–∏–º–∏
```

3. **–ó–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —Ç–µ—Å—Ç–æ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏:**
```bash
npm run seed
```

4. **–ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º—ñ —Ä–æ–∑—Ä–æ–±–∫–∏:**
```bash
npm run dev
```

5. **–ó–∞–ø—É—Å–∫ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—ñ:**
```bash
npm start
```

## üå± Seed Script

–°–∫—Ä–∏–ø—Ç `seed.ts` —Å—Ç–≤–æ—Ä—é—î –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω—É —Ç–µ—Å—Ç–æ–≤—É –±–∞–∑—É –¥–∞–Ω–∏—Ö –∑ —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏–º–∏ –¥–∞–Ω–∏–º–∏:

### –©–æ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è:
- **2 –º–∞–≥–∞–∑–∏–Ω–∏** (–ö–∏—ó–≤, –õ—å–≤—ñ–≤)
- **3 –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∏** –∑ —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏–º–∏ –Ω–∞–∑–≤–∞–º–∏
- **3 —Å–∫–ª–∞–¥–∏** –∑ —Ä–µ–∞–ª—ñ—Å—Ç–∏—á–Ω–∏–º–∏ –∞–¥—Ä–µ—Å–∞–º–∏
- **10 –ø—Ä–æ–¥—É–∫—Ç—ñ–≤** –∑ —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏–º–∏ –Ω–∞–∑–≤–∞–º–∏
- **4 –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ** –∑ —Ä—ñ–∑–Ω–∏–º–∏ —Ä–æ–ª—è–º–∏
- **–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∏** –∑ –ø—Ä–∏–≤'—è–∑–∫–æ—é –¥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- **–Ü–Ω–≤–µ–Ω—Ç–∞—Ä** —Ç–∞ **–ø–æ—Å—Ç–∞–≤–∫–∏**
- **–ü–æ–¥—ñ—ó –¥–æ—Å—Ç–∞–≤–∫–∏** —Ç–∞ **—Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è**
- **–ü–∞–ª–∏–≤–Ω—ñ –∫–∞—Ä—Ç–∫–∏** –¥–ª—è –≤–æ–¥—ñ—ó–≤
- **–ó–∞–ø—Ä–æ—à–µ–Ω–Ω—è** –Ω–æ–≤–∏—Ö —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤

### –¢–µ—Å—Ç–æ–≤—ñ –∞–∫–∞—É–Ω—Ç–∏:
```
Admin:      admin@groceryops.ua      / Admin123!
Logistics:  logistics@groceryops.ua  / Logistics123!
Driver:     driver@groceryops.ua     / Driver123!
Warehouse:  warehouse@groceryops.ua  / Warehouse123!
```

### –ó–∞–ø—É—Å–∫:
```bash
npm run seed
```

## üîß –ó–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞

```env
# Server Configuration
PORT=3001
NODE_ENV=development

# Supabase Configuration
SUPABASE_URL=your_supabase_project_url
SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key

# JWT Configuration
JWT_SECRET=your_super_secret_jwt_key_here
JWT_EXPIRES_IN=7d

# Email Configuration
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your_email@gmail.com
SMTP_PASS=your_app_password

# Frontend URL
FRONTEND_URL=http://localhost:5173
```

## üìö API Endpoints

### –ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è
- `POST /api/auth/create-admin` - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Ç–∞ –º–∞–≥–∞–∑–∏–Ω—É
- `POST /api/auth/signin` - –í—Ö—ñ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
- `POST /api/auth/signout` - –í–∏—Ö—ñ–¥ –∑ —Å–∏—Å—Ç–µ–º–∏
- `GET /api/auth/me` - –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

### –ó–∞–ø—Ä–æ—à–µ–Ω–Ω—è
- `POST /api/invitations` - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—è (admin)
- `POST /api/invitations/accept` - –ü—Ä–∏–π–Ω—è—Ç—Ç—è –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—è
- `GET /api/invitations` - –°–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–æ—à–µ–Ω—å (admin)
- `DELETE /api/invitations/:id` - –í–∏–¥–∞–ª–µ–Ω–Ω—è –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—è (admin)

### –ü—Ä–æ–¥—É–∫—Ç–∏
- `GET /api/products` - –°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤
- `GET /api/products/:id` - –î–µ—Ç–∞–ª—ñ –ø—Ä–æ–¥—É–∫—Ç—É
- `POST /api/products` - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç—É (logistics+)
- `PUT /api/products/:id` - –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç—É (logistics+)
- `DELETE /api/products/:id` - –í–∏–¥–∞–ª–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç—É (logistics+)
- `PATCH /api/products/:id/stock` - –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ø–∞—Å—ñ–≤ (logistics+)

### –ü–æ—Å—Ç–∞–≤–∫–∏
- `GET /api/deliveries` - –°–ø–∏—Å–æ–∫ –ø–æ—Å—Ç–∞–≤–æ–∫
- `GET /api/deliveries/:id` - –î–µ—Ç–∞–ª—ñ –ø–æ—Å—Ç–∞–≤–∫–∏
- `POST /api/deliveries` - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ—Å—Ç–∞–≤–∫–∏ (logistics+)
- `PATCH /api/deliveries/:id/status` - –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É
- `PATCH /api/deliveries/:id/assign-driver` - –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –≤–æ–¥—ñ—è (logistics+)

### –°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∏
- `GET /api/employees` - –°–ø–∏—Å–æ–∫ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤
- `GET /api/employees/:id` - –î–µ—Ç–∞–ª—ñ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞
- `PUT /api/employees/:id` - –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞
- `DELETE /api/employees/:id` - –í–∏–¥–∞–ª–µ–Ω–Ω—è —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞ (admin)

## üîê –†–æ–ª—ñ —Ç–∞ –¥–æ–∑–≤–æ–ª–∏

### Admin
- –ü–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –≤—Å—ñ—Ö —Ñ—É–Ω–∫—Ü—ñ–π
- –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞–º–∏ —Ç–∞ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—è–º–∏
- –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –º–∞–≥–∞–∑–∏–Ω–∞–º–∏

### Logistics Specialist
- –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏ —Ç–∞ –∑–∞–ø–∞—Å–∞–º–∏
- –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø–æ—Å—Ç–∞–≤–∫–∞–º–∏
- –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –≤–æ–¥—ñ—ó–≤

### Driver
- –ü–µ—Ä–µ–≥–ª—è–¥ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏—Ö –ø–æ—Å—Ç–∞–≤–æ–∫
- –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É –ø–æ—Å—Ç–∞–≤–æ–∫
- –ó–≤—ñ—Ç–∏ –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º–∏

### Warehouse Worker
- –ü–µ—Ä–µ–≥–ª—è–¥ –∑–∞–≤–¥–∞–Ω—å
- –°–∫–∞–Ω—É–≤–∞–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç—ñ–≤
- –ó–≤—ñ—Ç–∏ –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º–∏

## üõ° –ë–µ–∑–ø–µ–∫–∞

- **Helmet** –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É HTTP –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤
- **CORS** –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É
- **Rate Limiting** –¥–ª—è –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è–º
- **JWT —Ç–æ–∫–µ–Ω–∏** –¥–ª—è –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
- **–í–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö** –Ω–∞ –≤—Å—ñ—Ö endpoints
- **RLS (Row Level Security)** —á–µ—Ä–µ–∑ Supabase

## üìù –õ–æ–≥—É–≤–∞–Ω–Ω—è

–°–∏—Å—Ç–µ–º–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Winston –¥–ª—è –ª–æ–≥—É–≤–∞–Ω–Ω—è:
- `logs/error.log` - —Ç—ñ–ª—å–∫–∏ –ø–æ–º–∏–ª–∫–∏
- `logs/combined.log` - –≤—Å—ñ –ª–æ–≥–∏
- –ö–æ–Ω—Å–æ–ª—å - –≤ —Ä–µ–∂–∏–º—ñ —Ä–æ–∑—Ä–æ–±–∫–∏

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

```bash
npm test
```

## üìà –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥

Health check endpoint –¥–æ—Å—Ç—É–ø–Ω–∏–π –∑–∞ –∞–¥—Ä–µ—Å–æ—é:
```
GET /health
```

–ü–æ–≤–µ—Ä—Ç–∞—î —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞, —á–∞—Å —Ä–æ–±–æ—Ç–∏ —Ç–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ.

## üöÄ –î–µ–ø–ª–æ–π

1. **–í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞** –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É
2. **–ó–∞–ø—É—Å—Ç—ñ—Ç—å –±—ñ–ª–¥:**
```bash
npm run build
```
3. **–ó–∞–ø—É—Å—Ç—ñ—Ç—å —Å–µ—Ä–≤–µ—Ä:**
```bash
npm start
```

## üîÑ –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º

–ó–∞–º—ñ–Ω—ñ—Ç—å Edge Function –≤–∏–∫–ª–∏–∫–∏ –Ω–∞ HTTP –∑–∞–ø–∏—Ç–∏ –¥–æ —Ü—å–æ–≥–æ API:

```javascript
// –ó–∞–º—ñ—Å—Ç—å Edge Function
const response = await supabase.functions.invoke('create-admin', { body: data });

// –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ HTTP –∑–∞–ø–∏—Ç
const response = await fetch('/api/auth/create-admin', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${token}`
  },
  body: JSON.stringify(data)
});
```

## üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –ª–æ–∫–∞–ª—ñ–∑–∞—Ü—ñ—è

Seed —Å–∫—Ä–∏–ø—Ç —Å—Ç–≤–æ—Ä—é—î –¥–∞–Ω—ñ –∑ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –ª–æ–∫–∞–ª—ñ–∑–∞—Ü—ñ—î—é:
- –£–∫—Ä–∞—ó–Ω—Å—å–∫—ñ –Ω–∞–∑–≤–∏ –∫–æ–º–ø–∞–Ω—ñ–π —Ç–∞ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤
- –†–µ–∞–ª—ñ—Å—Ç–∏—á–Ω—ñ –∞–¥—Ä–µ—Å–∏ —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏—Ö –º—ñ—Å—Ç
- –¢–µ–ª–µ—Ñ–æ–Ω–∏ —É —Ñ–æ—Ä–º–∞—Ç—ñ +380XXXXXXXXX
- –Ñ–î–†–ü–û–£ —Ç–∞ –Ü–ü–ù –∫–æ–¥–∏
- –ü–æ—à—Ç–æ–≤—ñ —ñ–Ω–¥–µ–∫—Å–∏ –£–∫—Ä–∞—ó–Ω–∏

## üìû –ü—ñ–¥—Ç—Ä–∏–º–∫–∞

–î–ª—è –ø–∏—Ç–∞–Ω—å —Ç–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ —Å—Ç–≤–æ—Ä—ñ—Ç—å issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó –∞–±–æ –∑–≤'—è–∂—ñ—Ç—å—Å—è –∑ –∫–æ–º–∞–Ω–¥–æ—é —Ä–æ–∑—Ä–æ–±–∫–∏.